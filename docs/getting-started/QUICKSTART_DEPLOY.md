# Quick Start Guide - ComfyUI Backend Deployment

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏¢‡∏≤‡∏ß ‡πÜ

## üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Platform

### Option 1: RunPod (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Production) üí∞ ~$320/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:** GPU ‡∏î‡∏µ, ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ñ‡∏π‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢, Uptime ‡∏™‡∏π‡∏á  
**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:** ‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ä‡πâ

```bash
1. ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ RunPod: https://runpod.io
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å GPU: RTX 3090 (24GB) - $0.44/hr
3. Deploy: ‡πÉ‡∏ä‡πâ template "ComfyUI" (one-click)
4. ‡∏£‡∏≠ 5-10 ‡∏ô‡∏≤‡∏ó‡∏µ
5. ‡πÑ‡∏î‡πâ URL: https://xxx-yyy.runpod.io
```

### Option 2: Replicate (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô) üí∞ ~$0.17/‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:** ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡πÉ‡∏ä‡πâ, ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á deploy ‡πÄ‡∏≠‡∏á, ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ  
**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:** ‡πÅ‡∏û‡∏á‡∏ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏°‡∏≤‡∏Å (>1700 ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)

```bash
1. ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ Replicate: https://replicate.com
2. Get API Key
3. ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á deploy ‡∏≠‡∏∞‡πÑ‡∏£!
4. ‡πÅ‡∏Å‡πâ code ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Replicate API ‡πÅ‡∏ó‡∏ô ComfyUI
```

### Option 3: Hugging Face Spaces (‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏£‡∏µ) üí∞ ‡∏ü‡∏£‡∏µ 48 ‡∏ä‡∏°./‡πÄ‡∏î‡∏∑‡∏≠‡∏ô

**‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:** ‡∏ü‡∏£‡∏µ!, ‡∏á‡πà‡∏≤‡∏¢  
**‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏µ‡∏¢:** ‡∏à‡∏≥‡∏Å‡∏±‡∏î 48 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á GPU/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô, ‡∏ä‡πâ‡∏≤

```bash
1. ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ HF: https://huggingface.co
2. Create new Space
3. Upload comfyui-backend/ files
4. Enable GPU (T4)
5. ‡∏£‡∏≠ build ~15-20 ‡∏ô‡∏≤‡∏ó‡∏µ
```

---

## üöÄ Quick Deploy - RunPod (5 Minutes)

### 1. Create Pod (2 min)

```bash
# Go to RunPod Dashboard
# Click "Deploy" ‚Üí "Templates" ‚Üí Search "ComfyUI"
# Select: "ComfyUI Official Template"
# GPU: RTX 3090
# Storage: 100GB
# Click "Deploy"
```

### 2. SSH into Pod (1 min)

```bash
# Copy SSH command from RunPod dashboard
ssh root@xxx.runpod.io -p 12345

# Verify ComfyUI installed
ls /workspace/ComfyUI
```

### 3. Download Models (30 min - runs in background)

```bash
# Copy our download script
curl -O https://raw.githubusercontent.com/[your-repo]/download-models.sh
chmod +x download-models.sh

# Run download (will take ~30 minutes)
./download-models.sh

# Or download manually:
cd /workspace/ComfyUI/models/checkpoints
wget https://huggingface.co/stabilityai/stable-diffusion-xl-base-1.0/resolve/main/sd_xl_base_1.0.safetensors

cd ../animatediff_models
wget https://huggingface.co/guoyww/animatediff/resolve/main/mm-sd-v3.safetensors
```

### 4. Install Backend (1 min)

```bash
# Upload our backend files via SCP or git
cd /workspace
git clone [your-repo]/comfyui-backend
cd comfyui-backend

# Install dependencies
pip install -r requirements.txt
```

### 5. Configure & Run (1 min)

```bash
# Edit .env
cp .env.example .env
nano .env  # Set COMFYUI_PATH=/workspace/ComfyUI

# Run server
python main.py

# Should see:
# üöÄ ComfyUI Backend API starting...
# ‚úÖ ComfyUI found at /workspace/ComfyUI
# INFO: Uvicorn running on http://0.0.0.0:8000
```

### 6. Expose Public URL

```bash
# In RunPod dashboard:
# - Click your pod
# - "TCP Public IP" ‚Üí Enable
# - Copy URL: https://xxx-8000.proxy.runpod.net
```

### 7. Update Frontend

```bash
# In Peace Script AI project:
# Edit .env
VITE_COMFYUI_SERVICE_URL=https://xxx-8000.proxy.runpod.net
VITE_USE_COMFYUI_BACKEND=true

# Rebuild & deploy
npm run build
firebase deploy
```

### 8. Test! üéâ

```bash
# In Peace Script AI:
# 1. Select a shot
# 2. Click "Generate Video"
# 3. Select "ComfyUI + AnimateDiff"
# 4. Check console:
#    üé¨ Tier 2: Trying ComfyUI + AnimateDiff...
#    ‚úÖ Tier 2 Success!
```

---

## üß™ Alternative: Test Locally First (Mac/Windows with GPU)

### 1. Install ComfyUI

```bash
# Clone ComfyUI
git clone https://github.com/comfyanonymous/ComfyUI
cd ComfyUI
pip install -r requirements.txt

# Download models (run our script)
cd ..
./comfyui-backend/download-models.sh
```

### 2. Run ComfyUI

```bash
cd ComfyUI
python main.py

# Should open: http://localhost:8188
```

### 3. Run Backend

```bash
cd ../comfyui-backend
cp .env.example .env
# Edit: COMFYUI_PATH=../ComfyUI
python main.py

# Backend at: http://localhost:8000
```

### 4. Test Frontend

```bash
# Edit .env
VITE_COMFYUI_SERVICE_URL=http://localhost:8000
VITE_USE_COMFYUI_BACKEND=true

# Run dev server
npm run dev

# Test video generation!
```

---

## üî• Fastest Way (Replicate - No Deploy)

### 1. Get Replicate API Key

```bash
# Go to: https://replicate.com/account/api-tokens
# Copy token
```

### 2. Install Replicate Client

```bash
npm install replicate
```

### 3. Create Wrapper Function

```typescript
// src/services/replicateVideoService.ts
import Replicate from 'replicate';

const replicate = new Replicate({
  auth: import.meta.env.VITE_REPLICATE_API_KEY,
});

export async function generateVideoWithReplicate(
  prompt: string,
  baseImage: string
): Promise<string> {
  const output = await replicate.run(
    'stability-ai/stable-video-diffusion:3f0457e4619daac51203dedb472816fd4af51f3149fa7a9e0b5ffcf1b8172438',
    {
      input: {
        input_image: baseImage,
        cond_aug: 0.02,
        decoding_t: 14,
        video_length: '14_frames_with_svd',
        sizing_strategy: 'maintain_aspect_ratio',
        motion_bucket_id: 127,
        frames_per_second: 6,
      },
    }
  );

  return output as string;
}
```

### 4. Update geminiService.ts

```typescript
// Add to Tier 2/3 fallback
import { generateVideoWithReplicate } from './replicateVideoService';

// In generateVideo function:
if (preferredModel === 'auto') {
  try {
    // Tier 1: Veo (already working)
    ...
  } catch {
    // Tier 2: Replicate SVD
    console.log('üé¨ Tier 2: Trying Replicate SVD...');
    const result = await generateVideoWithReplicate(enhancedPrompt, base64Image);
    return result;
  }
}
```

### 5. Add to .env

```bash
VITE_REPLICATE_API_KEY=r8_xxxxxxxxxxxx
```

### 6. Done! No backend needed! üéâ

---

## üìä Cost Comparison

| Platform            | Setup Time | Monthly Cost     | Best For                     |
| ------------------- | ---------- | ---------------- | ---------------------------- |
| **RunPod RTX 3090** | 30 min     | $320             | Production (>1700 videos/mo) |
| **Replicate**       | 5 min      | $16/1000 videos  | Low volume, testing          |
| **HF Spaces Free**  | 20 min     | $0 (limited)     | Demo only                    |
| **Local GPU**       | 1 hour     | $0 (electricity) | Development                  |

---

## ‚è±Ô∏è Time to First Video

- **Replicate:** 5 minutes ‚úÖ FASTEST
- **RunPod Template:** 35 minutes (30 min models + 5 min setup)
- **Local:** 1-2 hours (download models + setup)
- **HF Spaces:** 40 minutes (build + models)

---

## üéØ Recommendation by Use Case

### "‡∏â‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢!"

‚Üí **Replicate** (5 ‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡πÉ‡∏ä‡πâ)

### "‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏ó‡∏≥ Production ‡∏à‡∏£‡∏¥‡∏á ‡πÜ"

‚Üí **RunPod** (30 ‡∏ô‡∏≤‡∏ó‡∏µ, $320/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)

### "‡∏â‡∏±‡∏ô‡∏≠‡∏¢‡∏≤‡∏Å‡∏•‡∏≠‡∏á‡∏ü‡∏£‡∏µ‡∏Å‡πà‡∏≠‡∏ô"

‚Üí **Hugging Face Spaces** (20 ‡∏ô‡∏≤‡∏ó‡∏µ, ‡∏ü‡∏£‡∏µ 48 ‡∏ä‡∏°.)

### "‡∏â‡∏±‡∏ô‡∏°‡∏µ GPU ‡πÅ‡∏£‡∏á ‡πÜ ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß"

‚Üí **Local** (1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á, ‡∏ü‡∏£‡∏µ)

---

## üÜò Need Help?

1. **Replicate not working?** ‚Üí Check API key in .env
2. **RunPod can't connect?** ‚Üí Verify public URL enabled
3. **Models not downloading?** ‚Üí Check disk space (need 20GB+)
4. **Video quality bad?** ‚Üí Try different model or increase steps

---

**‡∏™‡∏£‡∏∏‡∏õ:** ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚Üí ‡πÉ‡∏ä‡πâ **Replicate** (5 ‡∏ô‡∏≤‡∏ó‡∏µ!)  
‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏´‡∏¢‡∏±‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏¢‡∏≤‡∏ß ‚Üí ‡πÉ‡∏ä‡πâ **RunPod** (30 ‡∏ô‡∏≤‡∏ó‡∏µ)
